<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ë§¤ê³µë§¤ íƒ€ì´ë¨¸</title>

  <style>
    :root{
        color-scheme: dark;
        --bg: #0b0f19;                      /* í˜ì´ì§€ ë°°ê²½ */
        --text: var(--text);                    /* ê¸°ë³¸ ê¸€ììƒ‰ */
        --card-bg: rgba(255,255,255,0.06);  /* ì¹´ë“œ ë°°ê²½ */
        --card-border: rgba(255,255,255,0.12);
        --surface: rgba(255,255,255,0.06);   /* íƒ­/í•„/ì‘ì€ ì˜ì—­ */
        --surface2: rgba(0,0,0,0.18);        /* íŒ¨ë„ ë‚´ë¶€ ê°™ì€ ì§„í•œ ì˜ì—­ */

    }

    body{
      margin:0;
      min-height:100vh;
      display:grid;
      place-items:center;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    .card{
      width:min(720px, 94vw);
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 12px 40px rgba(0,0,0,0.35);
      backdrop-filter: blur(10px);
    }

    .top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      margin-bottom: 12px;
    }




    h1{
      margin:0;
      font-size: 18px;
      color: var(--text); 
      font-weight: 700;
      letter-spacing: 0.2px;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.14);
      background: var(--surface);
      color:var(--text);
      font-size:12px;
      white-space:nowrap;
    }


    

    /* íƒ­ */
    .tabs{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin: 8px 0 12px;
    }
    .tab{
      padding:10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.18);
      background: var(--surface);
      color:var(--text);
      cursor:pointer;
      font-size: 13px;
      user-select:none;
    }
    .tab.active{
      background: rgba(99,102,241,0.25);
      border-color: rgba(99,102,241,0.5);
      color:var(--text);
    }

    /* ë©”ì¸ íƒ€ì´ë¨¸ */
    .time{
      font-variant-numeric: tabular-nums;
      font-size: 56px;
      letter-spacing: 1px;
      text-align:center;
      margin: 16px 0 8px;
      color: var(--text); 
      text-shadow: 0 0 12px rgba(255,255,255,0.15);
    }

    .sub{
      text-align:center;
      font-size: 13px;
      margin-bottom: 14px;
      color:var(--text);
    }

    .row{
      display:flex;
      justify-content:center;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom: 6px;
    }

    button{
      padding: 12px 18px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.08);
      color:var(--text);
      cursor:pointer;
      font-size: 14px;
    }
    button.primary{
      background: rgba(34,197,94,0.25);
      border-color: rgba(34,197,94,0.45);
    }

    .hint{
      margin-top: 12px;
      text-align:center;
      font-size: 13px;
      color:#9ca3af;
    }
    code{ color:#e5e7eb; }

    /* íŒ¨ë„ (ì¼ë³„/ì›”ë³„) */
    .panel{
      border:1px solid rgba(255,255,255,0.12);
      background: var(--surface2);
      border-radius: 16px;
      padding: 12px;
      margin-top: 10px;
    }

    .panelHeader{
      display:flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 6px;
    }

    .panelTitle{
      margin:0;
      font-size: 13px;
      color:var(--text);
      font-weight: 700;
    }

    .panelSub{
      color:#9ca3af;
      font-size: 12px;
    }

    .item{
      display:flex;
      justify-content:space-between;
      gap:12px;
      padding: 10px 0;
      border-top: 1px solid rgba(255,255,255,0.08);
      font-variant-numeric: tabular-nums;
    }
    .item:first-of-type{ border-top:none; }
    .k{ color:var(--text); font-size: 13px; }
    .v{ color: var(--text); font-size: 13px; }

    /* ìš”ì•½ ì¹´ë“œ(ì¼ë³„/ì›”ë³„ ìƒë‹¨) */
    .summaryGrid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:10px;
      margin-top: 10px;
    }
    .stat{
      border:1px solid rgba(255,255,255,0.12);
      background: var(--surface2);
      border-radius: 16px;
      padding: 12px;
    }
    .label{ color:var(--text); font-size: 12px; margin-bottom: 6px; }
    .value{
      font-variant-numeric: tabular-nums;
      font-size: 18px;
      color:var(--text);
    }

    @media (max-width: 640px){
      .summaryGrid{ grid-template-columns: 1fr; }
      .time{ font-size: 50px; }
    }

    /* ì„¹ì…˜ í‘œì‹œ/ìˆ¨ê¹€ */
    .hidden{ display:none !important; }


        /* ===== ìº˜ë¦°ë” ===== */
    .calHeader{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    margin-top: 6px;
    margin-bottom: 10px;
    }

    .calTitle{
    font-weight: 800;
    color:var(--text);
    letter-spacing: 0.2px;
    }

    .calNav{
    padding: 8px 12px;
    border-radius: 12px;
    border:1px solid rgba(255,255,255,0.18);
    background: rgba(255,255,255,0.08);
    color:var(--text);
    cursor:pointer;
    font-size: 13px;
    }

    .calDow{
    display:grid;
    grid-template-columns: repeat(8, minmax(0, 1fr));
    gap:8px;
    margin-bottom: 8px;
    color:var(--text);
    font-size: 12px;
    text-align:center;
    }

    .calGrid{
    display:grid;
    grid-template-columns: repeat(8, minmax(0, 1fr));
    gap:8px;
    }

    .calCell{
    border:1px solid rgba(255,255,255,0.12);
    background: rgba(255,255,255,0.04);
    border-radius: 14px;
    padding: 10px 10px 8px;
    min-height: 64px;
    position: relative;
    overflow:hidden;
    }

    .calCell.muted{
    opacity: 0.35;
    }

    .calDay{
    font-size: 12px;
    color:var(--text);
    font-weight: 800;
    }

    .calTime{
    margin-top: 6px;
    font-variant-numeric: tabular-nums;
    font-size: 12px;
    color:var(--text);
    opacity: 0.95;
    }

    .calCell.today{
    outline: 2px solid rgba(99,102,241,0.55);
    outline-offset: 0px;
    }

    /* íˆíŠ¸ë§µ ë ˆë²¨(ë°°ê²½ ë†ë„) */
    .calCell.lv0{ background: rgba(255,255,255,0.04); }
    .calCell.lv1{ background: rgba(34,197,94,0.10); }
    .calCell.lv2{ background: rgba(34,197,94,0.18); }
    .calCell.lv3{ background: rgba(34,197,94,0.26); }
    .calCell.lv4{ background: rgba(34,197,94,0.34); }

    .calLegend{
    display:flex;
    align-items:center;
    gap:6px;
    margin-top: 10px;
    color:#9ca3af;
    font-size: 12px;
    justify-content:flex-end;
    }

    .dot{
    width: 12px;
    height: 12px;
    border-radius: 4px;
    border:1px solid rgba(255,255,255,0.12);
    display:inline-block;
    }
    .dot.lv0{ background: rgba(255,255,255,0.04); }
    .dot.lv1{ background: rgba(34,197,94,0.10); }
    .dot.lv2{ background: rgba(34,197,94,0.18); }
    .dot.lv3{ background: rgba(34,197,94,0.26); }
    .dot.lv4{ background: rgba(34,197,94,0.34); }

    .legendText{ margin-left: 4px; }


    .calCell.weekSum{
    border-style: dashed;
    background: rgba(255,255,255,0.06);
    }
    .calCell.weekSum .calDay{
    color:#9ca3af;
    font-weight: 700;
    }
    .calCell.weekSum .calTime{
    font-size: 12px;
    opacity: 0.95;
    }

    .theme-fab{
    position: fixed;
    right: 20px;
    bottom: 20px;
    z-index: 1000;
  }

  #themeBtn{
    width: 56px;
    height: 56px;
    border-radius: 50%;
    font-size: 22px;
    padding: 0;
  }

  #themePanel{
    position: absolute;
    right: 0;
    bottom: 70px;
    min-width: 220px;
  }



  </style>
</head>

<body>
  <div class="card">
    <div class="top">
      <h1>ë§¤ê³µë§¤ íƒ€ì´ë¨¸</h1>
    </div>


    <div class="theme-fab">
        <button id="themeBtn">ğŸ¨</button>
      
        <div id="themePanel" class="panel hidden" aria-hidden="true">
          <div class="panelHeader">
            <h2 class="panelTitle">ë°°ê²½ í…Œë§ˆ</h2>
          </div>
          <div id="themeButtons" class="row" style="justify-content:flex-start;"></div>
        </div>
    </div>



    <div class="tabs" role="tablist" aria-label="íƒ­">
      <div class="tab active" id="tabTimer" role="tab" aria-selected="true" tabindex="0">íƒ€ì´ë¨¸</div>
      <div class="tab" id="tabDaily" role="tab" aria-selected="false" tabindex="0">ì¼ë³„</div>
      <div class="tab" id="tabMonthly" role="tab" aria-selected="false" tabindex="0">ì›”ë³„</div>
      <div class="tab" id="tabPoints" role="tab" aria-selected="false" tabindex="0">í¬ì¸íŠ¸</div>
    </div>

    <!-- ===== íƒ€ì´ë¨¸ íƒ­ ===== -->
    <section id="sectionTimer">
      

        <!-- ì´ ê³µë¶€ì‹œê°„ -->
      <div id="display" class="time">00:00:00</div>

        <!-- ì˜¤ëŠ˜ ê³µë¶€ì‹œê°„ -->
      <div id="todayDisplay" class="time" style="font-size:36px; opacity:.9;">
        ì˜¤ëŠ˜ 00:00:00
      </div>


      <!-- âœ… ì—°ì†ê³µë¶€ í‘œì‹œ(ë©”ì¸) -->
      <div id="streakLine" class="sub" style="margin-bottom:8px;">
        ğŸ”¥ ì—°ì† 0ì¼ Â· ìµœê³  0ì¼
      </div>





      <div class="row">
        <button id="startPause" class="primary">ì‹œì‘</button>
      </div>


      <div class="panel" id="quoteBox">
        <div class="panelHeader">
          <div class="panelSub" id="quoteIndex"></div>
        </div>
      
        <div id="quoteText" style="font-size:15px; color: var(--text); line-height:1.6;"></div>
        <div id="quoteAuthor" style="margin-top:8px; font-size:13px; opacity:.85;"></div>
      </div>

      
    </section>

    <!-- ===== ì¼ë³„ íƒ­ ===== -->
    <section id="sectionDaily" class="hidden" aria-hidden="true">
      
        <div class="calHeader">
            <button class="calNav" id="calPrev" type="button">â—€</button>
            <div class="calTitle" id="calTitle">2025.12</div>
            <button class="calNav" id="calNext" type="button">â–¶</button>
          </div>
          
          <div class="calDow">
            <div>ì›”</div><div>í™”</div><div>ìˆ˜</div><div>ëª©</div><div>ê¸ˆ</div><div>í† </div><div>ì¼</div><div>í•©</div>
          </div>
          
          <div class="calGrid" id="calGrid"></div>
          
          <div class="calLegend">
            <span class="dot lv0"></span><span class="dot lv1"></span><span class="dot lv2"></span>
            <span class="dot lv3"></span><span class="dot lv4"></span>
            <span class="legendText">ê³µë¶€ëŸ‰</span>
          </div>
          

      
    </section>

    <!-- ===== ì›”ë³„ íƒ­ ===== -->
    <section id="sectionMonthly" class="hidden" aria-hidden="true">
      <div class="summaryGrid">
        <div class="stat">
          <div class="label">ì´ë²ˆ ë‹¬ ëˆ„ì </div>
          <div id="monthTotal" class="value">00:00:00</div>
        </div>
        <div class="stat">
          <div class="label">ìµœê·¼ 6ê°œì›” í•©</div>
          <div id="last6Total" class="value">00:00:00</div>
        </div>
      </div>

      <div class="panel">
        <div class="panelHeader">
          <h2 class="panelTitle">ìµœê·¼ 12ê°œì›”</h2>
        </div>
        <div id="monthlyList"></div>
      </div>
    </section>


    <!-- ===== í¬ì¸íŠ¸ íƒ­ ===== -->
    <section id="sectionPoints" class="hidden" aria-hidden="true">
        <div class="summaryGrid">
            <div class="stat">
                <div class="label">ë³´ìœ  í¬ì¸íŠ¸</div>
                <div id="pointsText" class="value">0P</div>
            </div>
            <div class="stat">
                <div class="label">ë°©ì–´ê¶Œ</div>
                <div id="shieldText" class="value">0ê°œ</div>
            </div>
        </div>

      <div class="panel">
        <div class="panelHeader">
            <h2 class="panelTitle">ê·œì¹™</h2>
            <div class="panelSub">ìë™ ì €ì¥</div>
        </div>

        <div class="item">
            <div class="k">ì‹œê°„ í¬ì¸íŠ¸</div>
            <div class="v">1ì‹œê°„ë§ˆë‹¤ +100P</div>
        </div>

        <div class="item">
            <div class="k">ì—°ì† ë³´ë„ˆìŠ¤</div>
            <div class="v">ì—°ì† 7ì¼ë§ˆë‹¤ +1000P</div>
        </div>

        <div class="item">
            <div class="k">ë°©ì–´ê¶Œ ê°€ê²©</div>
            <div class="v">2000P</div>
        </div>

        <div class="row" style="justify-content:flex-start; margin-top:10px;">
            <button id="buyShieldBtn" type="button">ë°©ì–´ê¶Œ êµ¬ë§¤ (2000P)</button>
        </div>


        <div class="panel" style="margin-top:12px;">
            <div class="panelHeader">
                <h2 class="panelTitle">ë°©ì–´ê¶Œ ì‚¬ìš©ë¨</h2>
                <div class="panelSub">ìë™ ê¸°ë¡</div>
            </div>
            <div id="shieldLogList"></div>
        </div>
      </div>

      <!-- ===== ë„ë°• ê²Œì„(ì„±ê³µ/ì‹¤íŒ¨) ===== -->
      <div class="panel">
        <div class="panelHeader">
          <h2 class="panelTitle">ë² íŒ… ê²Œì„</h2>
          <div class="panelSub">ì„±ê³µ/ì‹¤íŒ¨ë¡œ í¬ì¸íŠ¸ ë³€ë™</div>
        </div>

        <!-- 1) 200p ì´í•˜: ì„±ê³µ=2ë°°(ìˆœì´ìµ +ë² íŒ…), ì‹¤íŒ¨=ì „ì•¡ ì†Œë©¸ -->
        <div class="panel" style="margin-top:10px;">
          <div class="panelHeader">
            <h3 class="panelTitle">â‘  200P ì´í•˜: 2ë°° or 0</h3>
            <div class="panelSub">ì„±ê³µì´ë©´ +ë² íŒ…P / ì‹¤íŒ¨ë©´ -ë² íŒ…P</div>
          </div>

          <div class="row" style="justify-content:flex-start;">
            <input id="betSmall" type="number" min="1" max="200" placeholder="ë² íŒ…(1~200)" style="width:160px; padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,0.18); background: rgba(255,255,255,0.08); color: inherit;">
            <button id="btnSmall">ë„ì „</button>
            <div id="resultSmall" class="pill" style="margin-left:auto;">ëŒ€ê¸°ì¤‘</div>
          </div>
        </div>

        <!-- 2) ë¬´ì œí•œ: ì„±ê³µ=+20%, ì‹¤íŒ¨=-20% -->
        <div class="panel" style="margin-top:10px;">
          <div class="panelHeader">
            <h3 class="panelTitle">â‘¡ ë¬´ì œí•œ: +20% or -20%</h3>
            <div class="panelSub">ì„±ê³µì´ë©´ +ë² íŒ…ì˜ 20% / ì‹¤íŒ¨ë©´ -ë² íŒ…ì˜ 20%</div>
          </div>

          <div class="row" style="justify-content:flex-start;">
            <input id="betBig" type="number" min="1" placeholder="ë² íŒ…(ì œí•œì—†ìŒ)" style="width:180px; padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,0.18); background: rgba(255,255,255,0.08); color: inherit;">
            <button id="btnBig">ë„ì „</button>
            <div id="resultBig" class="pill" style="margin-left:auto;">ëŒ€ê¸°ì¤‘</div>
          </div>
        </div>
      </div>

      



    </section>
  </div>



  <script>
    // ===== DOM =====
    const $ = (id) => document.getElementById(id);


    const themeBtn = $("themeBtn");
    const themePanel = $("themePanel");
    const themeButtons = $("themeButtons");


    const tabTimer = $("tabTimer");
    const tabDaily = $("tabDaily");
    const tabMonthly = $("tabMonthly");

    const betSmall = document.getElementById("betSmall");
    const btnSmall = document.getElementById("btnSmall");
    const resultSmall = document.getElementById("resultSmall");

    const betBig = document.getElementById("betBig");
    const btnBig = document.getElementById("btnBig");
    const resultBig = document.getElementById("resultBig");


    const tabPoints = $("tabPoints");
    const sectionPoints = $("sectionPoints");

    const pointsText = $("pointsText");
    const shieldText = $("shieldText");
    const buyShieldBtn = $("buyShieldBtn");

    const sectionTimer = $("sectionTimer");
    const sectionDaily = $("sectionDaily");
    const sectionMonthly = $("sectionMonthly");

    const display = $("display");
    const statusEl = $("status");
    const todayDisplay = $("todayDisplay");
    const startPauseBtn = $("startPause");

    const streakLine = $("streakLine");

    const shieldLogListEl = $("shieldLogList");



    const quoteTextEl = $("quoteText");
    const quoteAuthorEl = $("quoteAuthor");

    const todayTotalEl = $("todayTotal");
    const monthTotalEl = $("monthTotal");
    const last6TotalEl = $("last6Total");


    const monthlyListEl = $("monthlyList");

    const calPrevBtn = $("calPrev");
    const calNextBtn = $("calNext");
    const calTitleEl = $("calTitle");
    const calGridEl  = $("calGrid");


    // ===== Storage =====

        // ===== ì˜¤ëŠ˜ì˜ ëª…ì–¸(31ê°œ) =====
    // indexëŠ” 0~30 (ì´ 31ê°œ). í™”ë©´ í‘œì‹œ ë²ˆí˜¸ëŠ” 1~31ë¡œ ìƒê°í•˜ë©´ ë¨.
    const QUOTES = [
    // 1
    { author: "ë²¤ìë¯¼ í”„ë­í´ë¦°", text: "ì˜¤ëŠ˜ í•  ì¼ì„ ë‚´ì¼ë¡œ ë¯¸ë£¨ì§€ ë§ˆë¼." },
    // 2
    { author: "ë§ˆì´í´ ì¡°ë˜", text: "ë‚˜ëŠ” ì‹¤íŒ¨í–ˆê¸° ë•Œë¬¸ì— ì„±ê³µí•  ìˆ˜ ìˆì—ˆë‹¤." },
    // 3
    { author: "ë¹Œ ê²Œì´ì¸ ", text: "ì„±ê³µì„ ì¶•í•˜í•˜ê¸° ì „ì—, ì‹¤íŒ¨ì—ì„œ ë°°ì›Œë¼." },
    // 4
    { author: "í—¨ë¦¬ í¬ë“œ", text: "í•  ìˆ˜ ìˆë‹¤ê³  ë¯¿ë“ , í•  ìˆ˜ ì—†ë‹¤ê³  ë¯¿ë“  ê·¸ ë¯¿ìŒì´ ë§ë‹¤." },
    // 5
    { author: "ì´ìˆœì‹ ", text: "í•„ì‚¬ì¦‰ìƒ, í•„ìƒì¦‰ì‚¬.(ì£½ê³ ì í•˜ë©´ ì‚´ê³ , ì‚´ê³ ì í•˜ë©´ ì£½ëŠ”ë‹¤)" },
    // 6
    { author: "ë‚˜í´ë ˆì˜¹ í", text: "ì§€ì†ì ì¸ ë…¸ë ¥ ì—†ì´ëŠ” ì–´ë–¤ ëª©í‘œë„ ì´ë£° ìˆ˜ ì—†ë‹¤." },
    // 7
    { author: "ì¡´ ë¡í ëŸ¬", text: "ì„±ê³µì˜ ë¹„ê²°ì€ í‰ë²”í•œ ì¼ì„ ë¹„ë²”í•˜ê²Œ í•˜ëŠ” ê²ƒì´ë‹¤." },
    // 8
    { author: "ë§ˆí•˜íŠ¸ë§ˆ ê°„ë””", text: "ë‚´ì¼ì˜ ë³€í™”ë¥¼ ì›í•œë‹¤ë©´ ì˜¤ëŠ˜ì˜ í–‰ë™ì„ ë°”ê¿”ë¼." },
    // 9
    { author: "í”Œë¼í†¤", text: "ì‹œì‘ì€ ê°€ì¥ ì¤‘ìš”í•œ ì¼ì´ë‹¤." },
    // 10
    { author: "ì•„ë¸Œë¼í•¨ ë§ì»¨", text: "ì²œì²œíˆ ê°€ë„ ë©ˆì¶”ì§€ë§Œ ì•Šìœ¼ë©´ ëœë‹¤." },
    // 11
    { author: "ë°•ì§€ì„±", text: "ì„±ê³µì€ í•˜ë£¨ì•„ì¹¨ì— ì˜¤ì§€ ì•ŠëŠ”ë‹¤." },
    // 12
    { author: "ê¹€ì—°ì•„", text: "ì—°ìŠµì€ ì ˆëŒ€ ë‚˜ë¥¼ ë°°ì‹ í•˜ì§€ ì•Šì•˜ë‹¤." },
    // 13
    { author: "í•œì„ì›", text: "ì„œìš¸ëŒ€ ê°€ê¸°ì— 1ë…„ì€ ë„ˆë¬´ ê¸¸ë‹¤." },
    // 14
    { author: "í•œì„ì›", text: "5ìˆ˜ë¥¼ í•´ì„œë¼ë„ ì„œìš¸ëŒ€ì— ê°€ë¼." },
    // 15
    { author: "ì´ì›ì¤€", text: "ì¸ìƒì„ ê±´ ì‹œí—˜ì— íˆ¬ë¨¸ì¹˜ëŠ” ì—†ë‹¤." },

    // 16~31 ë”ë¯¸(ë‚˜ì¤‘ì— êµì²´ìš©)
    { author: "í™ê¸¸ë™", text: "ê°€" },   // 16
    { author: "í™ê¸¸ë™", text: "ë‚˜" },   // 17
    { author: "í™ê¸¸ë™", text: "ë‹¤" },   // 18
    { author: "í™ê¸¸ë™", text: "ë¼" },   // 19
    { author: "í™ê¸¸ë™", text: "ë§ˆ" },   // 20
    { author: "í™ê¸¸ë™", text: "ë°”" },   // 21
    { author: "í™ê¸¸ë™", text: "ì‚¬" },   // 22
    { author: "í™ê¸¸ë™", text: "ì•„" },   // 23
    { author: "í™ê¸¸ë™", text: "ì" },   // 24
    { author: "í™ê¸¸ë™", text: "ì°¨" },   // 25
    { author: "í™ê¸¸ë™", text: "ì¹´" },   // 26
    { author: "í™ê¸¸ë™", text: "íƒ€" },   // 27
    { author: "í™ê¸¸ë™", text: "íŒŒ" },   // 28
    { author: "í™ê¸¸ë™", text: "í•˜" },   // 29
    { author: "í™ê¸¸ë™", text: "ê°€ê°€" }, // 30
    { author: "í™ê¸¸ë™", text: "ë‚˜ë‚˜" }  // 31
    ];




    const STORAGE_KEY = "study_stopwatch_tabs_v1";


    const THEME_KEY = "study_theme_v1";



    // ===== (ì—°ì†/ë°©ì–´ê¶Œ) ìƒíƒœ =====
    let streakCount = 0;           // ì—°ì† ì¼ìˆ˜
    let lastStreakDayKey = null;   // ë§ˆì§€ë§‰ìœ¼ë¡œ "ì—°ì† íŒì • ì²˜ë¦¬"í•œ ë‚ ì§œ (YYYY-MM-DD)

    // ë°©ì–´ê¶Œ ì‚¬ìš© ë¡œê·¸ [{ dayKey:"YYYY-MM-DD", usedAt: epochMs }]
    let shieldLog = [];

    // ë‚ ì§œí‚¤ ìœ í‹¸: epoch -> YYYY-MM-DD ëŠ” ë„¤ ì½”ë“œì˜ keyDayFromEpoch ê·¸ëŒ€ë¡œ ì“°ë©´ ë¨
    function dayKeyFromYMD(y, m, d){
        return `${y}-${String(m).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
    }
    function addDaysToKey(dayKey, deltaDays){
        const [y,m,d] = dayKey.split("-").map(Number);
        const dt = new Date(y, m-1, d + deltaDays);
        return dayKeyFromYMD(dt.getFullYear(), dt.getMonth()+1, dt.getDate());
    }
    function compareDayKey(a, b){
        // YYYY-MM-DD ë¬¸ìì—´ ë¹„êµë¡œë„ OK (í˜•ì‹ ê³ ì •ì´ë¼)
        if (a === b) return 0;
        return a < b ? -1 : 1;
    }

    // âœ… ë°©ì–´ê¶Œ ì‚¬ìš© ë¡œê·¸ ê¸°ë¡
    function logShieldUsed(dayKey){
        shieldLog.unshift({ dayKey, usedAt: Date.now() });
        // ë„ˆë¬´ ê¸¸ì–´ì§€ë©´ 200ê°œê¹Œì§€ë§Œ ì €ì¥
        if (shieldLog.length > 200) shieldLog.length = 200;
    }

    // âœ… (í•µì‹¬) lastStreakDayKey ë‹¤ìŒë‚ ë¶€í„° "ì–´ì œ"ê¹Œì§€ ì—°ì† íŒì •ì„ ì­‰ ìˆ˜í–‰
    // - í•˜ë£¨ ê³µë¶€ì‹œê°„ì´ STREAK_MIN_MS ë¯¸ë§Œì´ë©´ ì—°ì†ì´ ëŠê²¨ì•¼ í•¨
    // - ëŠê¸°ëŠ” ìˆœê°„ ë°©ì–´ê¶Œì´ ìˆìœ¼ë©´ 1ê°œ ìë™ ì†Œë¹„í•˜ê³  ì—°ì† ìœ ì§€
    function reconcileStreak(){
    // ì˜¤ëŠ˜ì€ ì•„ì§ í•˜ë£¨ê°€ ëë‚œ ê²Œ ì•„ë‹ˆë¼ì„œ "ì–´ì œ"ê¹Œì§€ë§Œ íŒì •í•˜ëŠ” ê²Œ ì•ˆì „í•¨
        const now = new Date();
        const yesterday = new Date(now.getFullYear(), now.getMonth(), now.getDate() - 1);
        const endKey = dayKeyFromYMD(yesterday.getFullYear(), yesterday.getMonth()+1, yesterday.getDate());

        // ì²˜ìŒì´ë©´: ì¼ë‹¨ ì–´ì œë¶€í„° ê±°ê¾¸ë¡œ â€œì—°ì†â€ì„ ê³„ì‚°í•˜ëŠ” ëŒ€ì‹ ,
        // ì—¬ê¸°ì„œëŠ” "ê¸°ì¡´ streakCountê°€ ì´ë¯¸ ìˆë‹¤"ëŠ” ì „ì œë¡œ lastStreakDayKeyë§Œ ì„¸íŒ…í•´ë„ ë¨.
        // (ì²˜ìŒ ë„ì…ì´ë¼ë©´ streakCount=0ë¶€í„° ì‹œì‘)
        if (!lastStreakDayKey){
            lastStreakDayKey = endKey;
            return;
        }

    // ì´ë¯¸ endKeyê¹Œì§€ ì²˜ë¦¬í–ˆìœ¼ë©´ í•  ì¼ ì—†ìŒ
        if (compareDayKey(lastStreakDayKey, endKey) >= 0) return;

        // lastStreakDayKey ë‹¤ìŒë‚ ë¶€í„° endKeyê¹Œì§€ í•˜ë£¨ì”© ì²˜ë¦¬
        let cur = addDaysToKey(lastStreakDayKey, 1);

        while (compareDayKey(cur, endKey) <= 0){
            const ms = daily[cur] || 0;

            if (ms >= STREAK_MIN_MS){
            // âœ… ì„±ê³µ: ì—°ì† +1
            streakCount += 1;
            } else {
                // âœ… ì‹¤íŒ¨: ë°©ì–´ê¶Œ ìˆìœ¼ë©´ ìë™ ì‚¬ìš©, ì—†ìœ¼ë©´ ì—°ì† 0
                if (shieldCount > 0){
                    shieldCount -= 1;
                    logShieldUsed(cur);
                    // ì—°ì† ìœ ì§€(ì¦ê°€ ì—†ìŒ)
                } else {
                    streakCount = 0;
                }
            }

            lastStreakDayKey = cur;       // âœ… ì´ ë‚ ì§œê¹Œì§€ ì²˜ë¦¬ ì™„ë£Œ
            cur = addDaysToKey(cur, 1);
        }

        save();
    }




    const THEMES = [
  // âœ… ë°ì€ ê³„ì—´: ë°°ê²½ì€ ë°ê²Œ, ì¹´ë“œ/í‘œë©´ì€ "ì€ì€í•œ íšŒìƒ‰ ìœ ë¦¬"ë¡œ ë¶„ë¦¬
    {
        id: "white", name: "í°ìƒ‰",
        bg: "#ffffff", text: "#111827",
        cardBg: "rgba(0,0,0,0.08)", cardBorder: "rgba(0,0,0,0.14)",
        surface: "rgba(0,0,0,0.10)",
        surface2: "rgba(0,0,0,0.10)"
    },
    {
        id: "gray", name: "íšŒìƒ‰",
        bg: "#3a3a3a", text: "#f9fafb",
        cardBg: "rgba(255,255,255,0.06)", cardBorder: "rgba(255,255,255,0.12)",
        surface: "rgba(255,255,255,0.06)",
        surface2: "rgba(0,0,0,0.18)"
    },
    {
        id: "butter", name: "ì—°ë…¸ë‘",
        bg: "#fff7cc", text: "#111827",
        cardBg: "rgba(0,0,0,0.08)", cardBorder: "rgba(0,0,0,0.14)",
        surface: "rgba(0,0,0,0.10)",
        surface2: "rgba(0,0,0,0.10)"
    },
    {
        id: "mint", name: "ì—°ë‘",
        bg: "#dcfce7", text: "#111827",
        cardBg: "rgba(0,0,0,0.08)", cardBorder: "rgba(0,0,0,0.14)",
        surface: "rgba(0,0,0,0.10)",
        surface2: "rgba(0,0,0,0.10)"
    },
    {
        id: "sky", name: "í•˜ëŠ˜",
        bg: "#dbeafe", text: "#111827",
        cardBg: "rgba(0,0,0,0.08)", cardBorder: "rgba(0,0,0,0.14)",
        surface: "rgba(0,0,0,0.10)",
        surface2: "rgba(0,0,0,0.10)"
    },
    {
        id: "pink", name: "ë¶„í™",
        bg: "#ffe4e6", text: "#111827",
        cardBg: "rgba(0,0,0,0.08)", cardBorder: "rgba(0,0,0,0.14)",
        surface: "rgba(0,0,0,0.10)",
        surface2: "rgba(0,0,0,0.10)"
    },

    // âœ… ì–´ë‘ìš´ ê³„ì—´: ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€(ë°ì€ ìœ ë¦¬í‘œë©´ + íŒ¨ë„ì€ ì–´ë‘¡ê²Œ)
    {
        id: "navy", name: "ë‚¨ìƒ‰",
        bg: "#0b0f19", text: "#f9fafb",
        cardBg: "rgba(255,255,255,0.06)", cardBorder: "rgba(255,255,255,0.12)",
        surface: "rgba(255,255,255,0.06)",
        surface2: "rgba(0,0,0,0.18)"
    },
    {
        id: "brown", name: "ê°ˆìƒ‰",
        bg: "#2b211b", text: "#f9fafb",
        cardBg: "rgba(255,255,255,0.06)", cardBorder: "rgba(255,255,255,0.12)",
        surface: "rgba(255,255,255,0.06)",
        surface2: "rgba(0,0,0,0.20)"
    }
    ];



    function applyTheme(t){
        const root = document.documentElement;
        root.style.setProperty("--bg", t.bg);
        root.style.setProperty("--text", t.text);
        root.style.setProperty("--card-bg", t.cardBg);
        root.style.setProperty("--card-border", t.cardBorder);
        root.style.setProperty("--surface", t.surface);
        root.style.setProperty("--surface2", t.surface2);
    }

    function saveThemeId(id){
        localStorage.setItem(THEME_KEY, id);
    }

    function loadTheme(){
        const saved = localStorage.getItem(THEME_KEY);
        const t = THEMES.find(x => x.id === saved) || THEMES.find(x => x.id === "navy");
        applyTheme(t);
    }

    function renderThemeButtons(){
        themeButtons.innerHTML = "";
        for (const t of THEMES){
            const b = document.createElement("button");
            b.type = "button";
            b.textContent = t.name;
            b.addEventListener("click", () => {
                applyTheme(t);
                saveThemeId(t.id);
            });
            themeButtons.appendChild(b);
        }
    }



    // ì „ì²´ ëˆ„ì (ms)
    let accumulatedMs = 0;

    // âœ… í¬ì¸íŠ¸/ë°©ì–´ê¶Œ ì €ì¥ìš©
    let bonusPoints = 0;        // ì—°ì† 7ì¼ ë³´ë„ˆìŠ¤ ëˆ„ì (1000Pì”©)
    let spentPoints = 0;        // ë°©ì–´ê¶Œ êµ¬ë§¤ë¡œ ì†Œë¹„í•œ í¬ì¸íŠ¸
    let shieldCount = 0;        // ë°©ì–´ê¶Œ ê°œìˆ˜

    

    // âœ… ì—°ì† ë³´ë„ˆìŠ¤ ì¤‘ë³µ ì§€ê¸‰ ë°©ì§€ìš©(í˜„ì¬ ìŠ¤íŠ¸ë¦­ "ëŸ°" ê¸°ì¤€)
    let prevStreakCur = 0;      // ì§ì „ ê³„ì‚°ëœ ì—°ì†/ì¼ìˆ˜
    let streakBonusMultiple = 0; // ì´ë²ˆ ìŠ¤íŠ¸ë¦­ì—ì„œ ì§€ê¸‰ ì™„ë£Œí•œ 7ì˜ ë°°ìˆ˜(0,1,2,...)


    // ì‹¤í–‰ ìƒíƒœ
    let running = false;

    // ì‹¤í–‰ ì‹œì‘ epoch(ms)
    let startEpochMs = null;

    // ë¶„ë°° ê¸°ì¤€ ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ epoch(ms)
    let lastUpdateEpochMs = null;

    // ê¸°ë¡
    // daily: { "YYYY-MM-DD": ms }
    // monthly: { "YYYY-MM": ms }
    let daily = {};
    let monthly = {};

    // ë Œë” íƒ€ì´ë¨¸
    let tickId = null;

    let viewYear = new Date().getFullYear();
    let viewMonth = new Date().getMonth(); // 0~11


    // ===== ë‚ ì§œ ìœ í‹¸ (ë¡œì»¬ ê¸°ì¤€) =====
    const pad2 = (n) => String(n).padStart(2, "0");

    function keyDayFromEpoch(epochMs) {
      const d = new Date(epochMs);
      return `${d.getFullYear()}-${pad2(d.getMonth() + 1)}-${pad2(d.getDate())}`;
    }

    function keyMonthFromEpoch(epochMs) {
      const d = new Date(epochMs);
      return `${d.getFullYear()}-${pad2(d.getMonth() + 1)}`;
    }

    function startOfNextDayEpoch(epochMs) {
      const d = new Date(epochMs);
      return new Date(d.getFullYear(), d.getMonth(), d.getDate() + 1, 0, 0, 0, 0).getTime();
    }

    // ===== ì‹œê°„ í¬ë§· =====
    function formatHMS(ms) {
      const totalSeconds = Math.floor(ms / 1000);
      const s = totalSeconds % 60;
      const totalMinutes = Math.floor(totalSeconds / 60);
      const mi = totalMinutes % 60;
      const h = Math.floor(totalMinutes / 60);
      return `${String(h).padStart(2,"0")}:${String(mi).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
    }


    // âœ… ìŠ¤íŠ¸ë¦­ ì„¤ì •: í•˜ë£¨ 10ë¶„ ì´ìƒì´ë©´ "ê³µë¶€í•œ ë‚ "
    const STREAK_MIN_MS = 10 * 60 * 1000; // 600,000ms

    function addDays(dateObj, deltaDays){
      const d = new Date(dateObj);
      d.setDate(d.getDate() + deltaDays);
      d.setHours(0,0,0,0);
      return d;
    }

    function dayKeyFromDate(dateObj){
      return `${dateObj.getFullYear()}-${String(dateObj.getMonth()+1).padStart(2,"0")}-${String(dateObj.getDate()).padStart(2,"0")}`;
    }

    function isQualifiedDay(dayKey){
      return (daily[dayKey] || 0) >= STREAK_MIN_MS;
    }

    // âœ… í˜„ì¬ ì—°ì†ì¼ ê³„ì‚°(ì˜¤ëŠ˜ í¬í•¨), ìµœê³ ê¸°ë¡ë„ ê°™ì´ ê³„ì‚°
    function computeStreak(){
      const today = new Date();
      today.setHours(0,0,0,0);

      // 1) í˜„ì¬ ì—°ì†
      let cur = 0;
      let d = today;
      while (true){
        const k = dayKeyFromDate(d);
        if (!isQualifiedDay(k)) break;
        cur += 1;
        d = addDays(d, -1);
      }

      // 2) ìµœê³  ì—°ì† (ì €ì¥ëœ daily ì „ì²´ë¥¼ í›‘ì–´ì„œ ê³„ì‚°)
      //    - ë°ì´í„°ê°€ ë§ì•„ë„ 1~2ë…„ ìˆ˜ì¤€ì´ë©´ ì¶©ë¶„íˆ ë¹ ë¦„
      const keys = Object.keys(daily).sort(); // YYYY-MM-DD ì •ë ¬
      let best = 0;
      let run = 0;
      let prev = null;

      for (const k of keys){
        if (!isQualifiedDay(k)) continue;

        if (prev){
          const prevDate = new Date(prev + "T00:00:00");
          const thisDate = new Date(k + "T00:00:00");
          const diffDays = Math.round((thisDate - prevDate) / (24*60*60*1000));

          if (diffDays === 1) run += 1;
          else run = 1;
        } else {
          run = 1;
        }

        if (run > best) best = run;
        prev = k;
      }

      // bestëŠ” ì €ì¥ ë°ì´í„° ê¸°ì¤€ì´ë¼, "ì˜¤ëŠ˜ì´ ì•„ì§ dailyì— ì—†ìœ¼ë©´" bestê°€ curë³´ë‹¤ ë‚®ì„ ìˆ˜ ìˆìŒ
      // (í•˜ì§€ë§Œ ë„¤ ì•±ì€ tickë§ˆë‹¤ daily ì—…ë°ì´íŠ¸í•˜ë‹ˆê¹Œ ê±°ì˜ ë¬¸ì œ ì—†ìŒ)
      if (cur > best) best = cur;

      return { cur, best };
    }


    // âœ… í¬ì¸íŠ¸ ê·œì¹™
    const POINTS_PER_HOUR = 100;          // 1ì‹œê°„ë§ˆë‹¤ 100P
    const STREAK_BONUS = 1000;            // 7ì¼ë§ˆë‹¤ +1000P
    const SHIELD_PRICE = 2000;            // ë°©ì–´ê¶Œ ê°€ê²©

    function basePointsFromTotalMs(ms){
        const hours = Math.floor(ms / (60 * 60 * 1000));
        return hours * POINTS_PER_HOUR;
    }

    function totalEarnedPoints(){
        return basePointsFromTotalMs(accumulatedMs) + bonusPoints;
    }

    function availablePoints(){
        return Math.max(0, totalEarnedPoints() - spentPoints);
    }

// âœ… ì—°ì† 7ì˜ ë°°ìˆ˜ ë³´ë„ˆìŠ¤ ì§€ê¸‰(ì¤‘ë³µ ë°©ì§€)
    function updateStreakBonus(){
        const { cur } = computeStreak();

        // ìŠ¤íŠ¸ë¦­ì´ ì¤„ì—ˆìœ¼ë©´(ëŠê²¼ê±°ë‚˜) "ì´ë²ˆ ëŸ°" ë³´ë„ˆìŠ¤ ì¹´ìš´í„° ì´ˆê¸°í™”
        if (cur < prevStreakCur) {
            streakBonusMultiple = 0;
        }

        const multiple = Math.floor(cur / 7); // 0,1,2,... (7ì¼=1, 14ì¼=2)

        if (multiple > streakBonusMultiple) {
            const gained = (multiple - streakBonusMultiple) * STREAK_BONUS;
            bonusPoints += gained;
            streakBonusMultiple = multiple;
            save(); // ë³´ë„ˆìŠ¤ ì§€ê¸‰ ê²°ê³¼ ì €ì¥
        }

        prevStreakCur = cur;
    }





    function heatLevel(ms){
      const h = ms / (1000 * 60 * 60); // hours
      if (h <= 0) return 0;
      if (h < 1) return 1;
      if (h < 3) return 2;
      if (h < 6) return 3;
      return 4;
    }

    function formatHM(ms){
    const totalMinutes = Math.floor(ms / 60000);
    const h = Math.floor(totalMinutes / 60);
    const m = totalMinutes % 60;
    return `${h}:${String(m).padStart(2,"0")}`;
    }



    // ===== Save/Load =====
    function save() {
      const data = { accumulatedMs, running, startEpochMs, lastUpdateEpochMs, daily, monthly, 
        bonusPoints, spentPoints, shieldCount, prevStreakCur, streakBonusMultiple,streakCount, lastStreakDayKey, shieldLog };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    function load() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return;
        const data = JSON.parse(raw);

        if (typeof data.accumulatedMs === "number") accumulatedMs = data.accumulatedMs;
        if (typeof data.running === "boolean") running = data.running;
        if (typeof data.startEpochMs === "number") startEpochMs = data.startEpochMs;
        if (typeof data.lastUpdateEpochMs === "number") lastUpdateEpochMs = data.lastUpdateEpochMs;

        if (data.daily && typeof data.daily === "object") daily = data.daily;
        if (data.monthly && typeof data.monthly === "object") monthly = data.monthly;

        if (typeof data.bonusPoints === "number") bonusPoints = data.bonusPoints;
        if (typeof data.spentPoints === "number") spentPoints = data.spentPoints;
        if (typeof data.shieldCount === "number") shieldCount = data.shieldCount;
        if (typeof data.prevStreakCur === "number") prevStreakCur = data.prevStreakCur;
        if (typeof data.streakBonusMultiple === "number") streakBonusMultiple = data.streakBonusMultiple;

        if (typeof data.streakCount === "number") streakCount = data.streakCount;
        if (typeof data.lastStreakDayKey === "string") lastStreakDayKey = data.lastStreakDayKey;
        if (Array.isArray(data.shieldLog)) shieldLog = data.shieldLog;
        



      } catch { /* ignore */ }
    }

    // ===== ê¸°ë¡ ë¶„ë°° (ìì • ë„˜ì–´ë„ ì •í™•íˆ) =====
    function addMsToMaps(dayKey, monthKey, ms) {
      if (ms <= 0) return;
      daily[dayKey] = (daily[dayKey] || 0) + ms;
      monthly[monthKey] = (monthly[monthKey] || 0) + ms;
    }

    function distributeInterval(startMs, endMs) {
      let cur = startMs;
      while (cur < endMs) {
        const dayKey = keyDayFromEpoch(cur);
        const monthKey = keyMonthFromEpoch(cur);
        const nextDay = startOfNextDayEpoch(cur);
        const sliceEnd = Math.min(endMs, nextDay);
        addMsToMaps(dayKey, monthKey, sliceEnd - cur);
        cur = sliceEnd;
      }
    }

    function applyDelta() {
      if (!running) return;
      const now = Date.now();
      if (!lastUpdateEpochMs) lastUpdateEpochMs = now;

      const start = lastUpdateEpochMs;
      const end = now;
      if (end <= start) return;

      const delta = end - start;
      accumulatedMs += delta;
      distributeInterval(start, end);

      reconcileStreak(); // âœ… ë‚ ì§œê°€ ë°”ë€Œì–´ ì—°ì†ì´ ëŠê²¼ëŠ”ì§€/ë°©ì–´ê¶Œ ìë™ ì†Œë¹„í• ì§€ íŒì •


      lastUpdateEpochMs = now;
      save();
    }

    // ===== UI: íƒ­ =====
    function setActiveTab(which) {
      const tabs = [
        { tab: tabTimer, section: sectionTimer, key: "timer" },
        { tab: tabDaily, section: sectionDaily, key: "daily" },
        { tab: tabMonthly, section: sectionMonthly, key: "monthly" },
        { tab: tabPoints, section: sectionPoints, key: "points" }

        
        
      ];

      for (const t of tabs) {
        const active = t.key === which;
        t.tab.classList.toggle("active", active);
        t.tab.setAttribute("aria-selected", active ? "true" : "false");
        t.section.classList.toggle("hidden", !active);
        t.section.setAttribute("aria-hidden", active ? "false" : "true");
      }

      // íƒ­ ì „í™˜ ì‹œ ìµœì‹  ìˆ˜ì¹˜ ë°˜ì˜
      if (running) applyDelta();
      renderAll();
    }

    tabTimer.addEventListener("click", () => setActiveTab("timer"));
    tabDaily.addEventListener("click", () => setActiveTab("daily"));
    tabMonthly.addEventListener("click", () => setActiveTab("monthly"));
    tabPoints.addEventListener("click", () => setActiveTab("points"));


    themeBtn.addEventListener("click", () => {
        const isHidden = themePanel.classList.contains("hidden");
        themePanel.classList.toggle("hidden", !isHidden);
        themePanel.setAttribute("aria-hidden", isHidden ? "false" : "true");
    });


    calPrevBtn.addEventListener("click", () => {
        viewMonth -= 1;
        if (viewMonth < 0) { viewMonth = 11; viewYear -= 1; }
        renderAll();
        });

        calNextBtn.addEventListener("click", () => {
        viewMonth += 1;
        if (viewMonth > 11) { viewMonth = 0; viewYear += 1; }
        renderAll();
        });


    calNextBtn.addEventListener("click", () => {
        viewMonth += 1;
        if (viewMonth > 11) { viewMonth = 0; viewYear += 1; }
        renderAll();
    });


    // âœ… ë°©ì–´ê¶Œ êµ¬ë§¤ ë²„íŠ¼
    buyShieldBtn.addEventListener("click", () => {
        const p = availablePoints();

        if (p < SHIELD_PRICE) {
            alert(`í¬ì¸íŠ¸ê°€ ë¶€ì¡±í•´ìš”! (í•„ìš”: ${SHIELD_PRICE}P, í˜„ì¬: ${p}P)`);
            return;
        }

        spentPoints += SHIELD_PRICE;
        shieldCount += 1;
        save();
        renderAll();
    });

    btnSmall.addEventListener("click", () => {
      const bet = Math.floor(Number(betSmall.value));
      if (!Number.isFinite(bet) || bet <= 0) return alert("ë² íŒ…ê°’ì„ 1 ì´ìƒ ì…ë ¥!");
      if (bet > 200) return alert("ì´ ê²Œì„ì€ 200P ì´í•˜ë§Œ ê°€ëŠ¥!");
      const p = availablePoints();
      if (bet > p) return alert(`í¬ì¸íŠ¸ ë¶€ì¡±! (í˜„ì¬ ${p}P)`);

      const success = Math.random() < 0.5;

      if (success) {
        bonusPoints += bet;           // âœ… ì„±ê³µ ë³´ë„ˆìŠ¤
        resultSmall.textContent = `ì„±ê³µ! +${bet}P`;
      } else {
        spentPoints += bet;           // âœ… ì‹¤íŒ¨ ì°¨ê°
        resultSmall.textContent = `ì‹¤íŒ¨... -${bet}P`;
      }

      save();
      renderAll();
    });

    btnBig.addEventListener("click", () => {
      const bet = Math.floor(Number(betBig.value));
      if (!Number.isFinite(bet) || bet <= 0) return alert("ë² íŒ…ê°’ì„ 1 ì´ìƒ ì…ë ¥!");
      const p = availablePoints();
      if (bet > p) return alert(`í¬ì¸íŠ¸ ë¶€ì¡±! (í˜„ì¬ ${p}P)`);

      const delta = Math.max(1, Math.floor(bet * 0.2)); // 20% (ìµœì†Œ 1P)
      const success = Math.random() < 0.5;

      if (success) {
        bonusPoints += delta;         // âœ… ì„±ê³µ ë³´ë„ˆìŠ¤
        resultBig.textContent = `ì„±ê³µ! +${delta}P (20%)`;
      } else {
        spentPoints += delta;         // âœ… ì‹¤íŒ¨ ì°¨ê°
        resultBig.textContent = `ì‹¤íŒ¨... -${delta}P (20%)`;
      }

      save();
      renderAll();
    });







    // í‚¤ë³´ë“œë¡œ íƒ­ ì´ë™(ì„ íƒ)
    [tabTimer, tabDaily, tabMonthly, tabPoints].forEach((el) => {
      el.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          el.click();
        }
      });
    });

    // ===== UI: ë¦¬ìŠ¤íŠ¸ ë Œë” =====
    function sumMs(values) {
      let s = 0;
      for (const v of values) s += v || 0;
      return s;
    }

    

    function renderMonthly() {
      const now = Date.now();
      const monthKey = keyMonthFromEpoch(now);

      const monthMs = monthly[monthKey] || 0;
      monthTotalEl.textContent = formatHMS(monthMs);

      // ìµœê·¼ 6ê°œì›” í•© (ì´ë²ˆë‹¬ í¬í•¨)
      const last6 = [];
      {
        const d = new Date();
        d.setDate(1);
        d.setHours(0,0,0,0);
        for (let i = 0; i < 6; i++) {
          const md = new Date(d.getFullYear(), d.getMonth() - i, 1, 0, 0, 0, 0);
          const k = keyMonthFromEpoch(md.getTime());
          last6.push(monthly[k] || 0);
        }
      }
      last6TotalEl.textContent = formatHMS(sumMs(last6));

      // ìµœê·¼ 12ê°œì›” ë¦¬ìŠ¤íŠ¸
      const items = [];
      {
        const d = new Date();
        d.setDate(1);
        d.setHours(0,0,0,0);
        for (let i = 0; i < 12; i++) {
          const md = new Date(d.getFullYear(), d.getMonth() - i, 1, 0, 0, 0, 0);
          const k = keyMonthFromEpoch(md.getTime());
          items.push([k, monthly[k] || 0]);
        }
      }

      monthlyListEl.innerHTML = items.map(([k, ms]) => {
        const label = k.replace("-", ".");
        return `<div class="item"><div class="k">${label}</div><div class="v">${formatHMS(ms)}</div></div>`;
      }).join("");
    }


    function renderCalendar(){
        // íƒ€ì´í‹€
        calTitleEl.textContent = `${viewYear}.${String(viewMonth + 1).padStart(2,"0")}`;

        // grid ë¹„ìš°ê¸°
        calGridEl.innerHTML = "";

        // ì´ ë‹¬ 1ì¼
        const first = new Date(viewYear, viewMonth, 1);
        const firstDow = (first.getDay() + 6) % 7; // 0(ì›”)~6(ì¼)

        // ì´ ë‹¬ ë§ˆì§€ë§‰ ë‚ ì§œ
        const lastDay = new Date(viewYear, viewMonth + 1, 0).getDate();

        // ìº˜ë¦°ë”ëŠ” ë³´í†µ 6ì£¼(42ì¹¸) ê³ ì •ì´ ë³´ê¸° ì¢‹ìŒ
        const totalCells = 42;

        // ì˜¤ëŠ˜ í‘œì‹œìš©
        const today = new Date();
        const todayY = today.getFullYear();
        const todayM = today.getMonth();
        const todayD = today.getDate();

        for (let week = 0; week < 6; week++) {
            let weekMs = 0; // ì´ë²ˆ ì£¼ í•©ê³„(ì´ ë‹¬ ë‚ ì§œë§Œ í•©ì‚°)

            for (let dow = 0; dow < 7; dow++) {
                const i = week * 7 + dow; // 0~41
                const cell = document.createElement("div");
                cell.className = "calCell lv0 muted";

                const dayNum = i - firstDow + 1;
                const dateObj = new Date(viewYear, viewMonth, dayNum);
                const inThisMonth = (dateObj.getFullYear() === viewYear && dateObj.getMonth() === viewMonth);

                const key = `${dateObj.getFullYear()}-${String(dateObj.getMonth()+1).padStart(2,"0")}-${String(dateObj.getDate()).padStart(2,"0")}`;
                const ms = daily[key] || 0;
                weekMs += ms; // âœ… íšŒìƒ‰ í¬í•¨í•´ì„œ í•­ìƒ ë”í•¨

                if (inThisMonth) {
                    cell.classList.remove("muted");

                    const key = `${viewYear}-${String(viewMonth+1).padStart(2,"0")}-${String(dayNum).padStart(2,"0")}`;
                    const ms = daily[key] || 0;

                    

                    const lv = heatLevel(ms);
                    cell.classList.add(`lv${lv}`);

                    if (dateObj.getFullYear() === todayY && dateObj.getMonth() === todayM && dateObj.getDate() === todayD) {
                        cell.classList.add("today");
                    }

                    const dayEl = document.createElement("div");
                    dayEl.className = "calDay";
                    dayEl.textContent = dateObj.getDate();

                    const timeEl = document.createElement("div");
                    timeEl.className = "calTime";
                    timeEl.textContent = ms > 0 ? formatHM(ms) : "";

                    cell.appendChild(dayEl);
                    cell.appendChild(timeEl);
                }

                calGridEl.appendChild(cell);
            }

            // âœ… ì£¼ í•©ê³„ ì¹¸(8ë²ˆì§¸ ì—´)
            const sumCell = document.createElement("div");
            sumCell.className = "calCell weekSum";

            const labelEl = document.createElement("div");
            labelEl.className = "calDay";
            labelEl.textContent = "í•©";

            const sumEl = document.createElement("div");
            sumEl.className = "calTime";
            sumEl.textContent = weekMs > 0 ? formatHM(weekMs) : "";

            sumCell.appendChild(labelEl);
            sumCell.appendChild(sumEl);

            calGridEl.appendChild(sumCell);
            }
        }





        function renderTimer() {
    // ì´ ê³µë¶€ì‹œê°„
    display.textContent = formatHMS(accumulatedMs);

    // ì˜¤ëŠ˜ ê³µë¶€ì‹œê°„
    const todayKey = keyDayFromEpoch(Date.now());
    const todayMs = daily[todayKey] || 0;
    todayDisplay.textContent = "ì˜¤ëŠ˜ " + formatHMS(todayMs);

    document.title = running
        ? `â±ï¸ ${formatHMS(accumulatedMs)}`
        : `ë§¤ê³µë§¤ íƒ€ì´ë¨¸ - ${formatHMS(accumulatedMs)}`;



    startPauseBtn.textContent = running ? "ì¼ì‹œì •ì§€" : "ì‹œì‘";

    // âœ… ìŠ¤íŠ¸ë¦­ í‘œì‹œ ê°±ì‹ 
    const { cur, best } = computeStreak();
    streakLine.textContent = `ğŸ”¥ ì—°ì† ${cur}ì¼`;

    }


    function renderPoints(){
        pointsText.textContent = `${availablePoints()}P`;
        shieldText.textContent = `${shieldCount}ê°œ`;
    }


    function renderShieldLog(){
        if (!shieldLogListEl) return;

        if (!shieldLog || shieldLog.length === 0){
            shieldLogListEl.innerHTML = `<div class="item"><div class="k">ì‚¬ìš© ê¸°ë¡ ì—†ìŒ</div><div class="v"></div></div>`;
            return;
        }

        shieldLogListEl.innerHTML = shieldLog.slice(0, 30).map((x) => {
            const mmdd = x.dayKey.slice(5).replace("-", "/");
            return `<div class="item">
                <div class="k">${mmdd}</div>
                <div class="v">ë°©ì–´ê¶Œ 1ê°œ ì‚¬ìš©</div>
            </div>`;
        }).join("");
    }



        // ===== ëª…ì–¸: ë‚ ì§œ â†’ 31ë¡œ ë‚˜ëˆˆ ë‚˜ë¨¸ì§€ =====
    const QUOTE_MOD = 31;

    // ê¸°ì¤€ì¼(ì ˆëŒ€ ë°”ê¾¸ì§€ ë§ê¸°): 2025-01-01
    const QUOTE_BASE = new Date(2025, 0, 1); // (ë…„,ì›”0~11,ì¼)

    function dayIndexSinceBase(now = new Date()){
    // ìì • ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°(ì‹œê°„ ì˜í–¥ ì œê±°)
        const a = new Date(QUOTE_BASE.getFullYear(), QUOTE_BASE.getMonth(), QUOTE_BASE.getDate());
        const b = new Date(now.getFullYear(), now.getMonth(), now.getDate());
        const diffDays = Math.floor((b.getTime() - a.getTime()) / (24*60*60*1000));
        return diffDays;
    }

    function getTodayQuote(){
        const idx = ((dayIndexSinceBase() % QUOTE_MOD) + QUOTE_MOD) % QUOTE_MOD; // 0~30
        const q = QUOTES[idx] || { author:"", text:"" };
        return { idx, q };
    }

    function renderQuote(){
        const { idx, q } = getTodayQuote();

        

        quoteTextEl.textContent = `â€œ${q.text}â€`;
        quoteAuthorEl.textContent = q.author ? `â€” ${q.author}` : "";
    }


    function renderAll() {
      renderTimer();
      renderQuote();
      renderCalendar();
      renderMonthly();
      updateStreakBonus();
      renderPoints();
      renderShieldLog();

    }

    // ===== ë™ì‘ ì œì–´ =====
    function start() {
      if (running) return;
      running = true;
      const now = Date.now();
      startEpochMs = now;
      lastUpdateEpochMs = now;
      save();

      if (tickId) clearInterval(tickId);
      tickId = setInterval(() => {
        applyDelta();
        // íƒ€ì´ë¨¸ëŠ” í•­ìƒ ë¶€ë“œëŸ½ê²Œ ì—…ë°ì´íŠ¸, ë‹¤ë¥¸ íƒ­ë„ ìˆ«ìëŠ” ìœ ì§€ë˜ê²Œ ê°™ì´ ê°±ì‹ 
        renderAll();
      }, 250);

      renderAll();
    }

    function pause() {
      if (!running) return;
      applyDelta();

      running = false;
      startEpochMs = null;
      lastUpdateEpochMs = null;
      save();

      if (tickId) clearInterval(tickId);
      tickId = null;

      renderAll();
    }

    function toggle() {
      running ? pause() : start();
    }





    startPauseBtn.addEventListener("click", toggle);

    window.addEventListener("keydown", (e) => {
      if (e.code === "Space") {
        e.preventDefault();
        toggle();
      }
    });

    window.addEventListener("beforeunload", () => {
      if (running) applyDelta();
      save();
    });

    // ===== ì´ˆê¸° ë¡œë“œ ë° "êº¼ì ¸ìˆë˜ ë™ì•ˆ" ë°˜ì˜ =====
    load();
    loadTheme();
    renderThemeButtons();

    // ì €ì¥ ë‹¹ì‹œ runningì´ì—ˆë‹¤ë©´, lastUpdateEpochMs(or startEpochMs)ë¶€í„° ì§€ê¸ˆê¹Œì§€ ì‹œê°„ì„ ë¶„ë°°í•´ì„œ ë°˜ì˜
    if (running && typeof startEpochMs === "number") {
      const now = Date.now();
      const startForCatchup =
        (typeof lastUpdateEpochMs === "number" && lastUpdateEpochMs) ? lastUpdateEpochMs : startEpochMs;

      if (now > startForCatchup) {
        distributeInterval(startForCatchup, now);
        accumulatedMs += (now - startForCatchup);
      }

      // ê³„ì† ì‹¤í–‰
      lastUpdateEpochMs = now;
      startEpochMs = now;
      save();

      tickId = setInterval(() => {
        applyDelta();
        renderAll();
      }, 250);
    }

    reconcileStreak();

    // ìµœì´ˆ ë Œë”
    renderAll();
    setActiveTab("timer");
  </script>
</body>
</html>
